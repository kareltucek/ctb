
\begin{tikzpicture}[>=latex,line join=bevel,]
%%
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{0,0,0};
  \pgfsetstrokecolor{strokecol}
  \draw (460bp,356bp) -- (460bp,476bp) -- (608bp,476bp) -- (608bp,356bp) -- cycle;
  \draw (534bp,462bp) node {some partition j \textless i};
\end{scope}
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{0,0,0};
  \pgfsetstrokecolor{strokecol}
  \draw [solid] (635bp,64bp) -- (635bp,538bp) -- (1000bp,538bp) -- (1000bp,64bp) -- cycle;
  \draw (817bp,523bp) node {vectorized code of partition i};
\end{scope}
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{0,0,0};
  \pgfsetstrokecolor{strokecol}
  \draw [solid] (5bp,6bp) -- (5bp,600bp) -- (454bp,600bp) -- (454bp,6bp) -- cycle;
  \draw (230bp,585bp) node {singular code of partition i};
\end{scope}
\begin{scope}
  \pgfsetstrokecolor{black}
  \definecolor{strokecol}{rgb}{0,0,0};
  \pgfsetstrokecolor{strokecol}
  \draw (465bp,64bp) -- (465bp,183bp) -- (623bp,183bp) -- (623bp,64bp) -- cycle;
  \draw (545bp,169bp) node {some partition j \textgreater i};
\end{scope}
  \node (sbodylab) at (152bp,204bp) [draw,rectangle] {SINGULAR\_BODY\_i};
  \node (sbody) at (152bp,85bp) [draw,ellipse] {$\begin{matrix} \text{process body} \\ \text{remaining --} \end{matrix}$ };
  \node (vbody) at (810bp,142bp) [draw,ellipse] {$\begin{matrix} \text{process body} \\ \text{remaining -= vector size} \end{matrix}$ };
  \node (inv) at (534bp,435bp) [draw,rectangle] {PARTITION\_j};
  \node (ins) at (534bp,377bp) [draw,rectangle] {SINGULAR\_PARTITION\_j};
  \node (sterm) at (246bp,435bp) [draw,ellipse] {i != 0 ? handle\_termination\_nonzero};
  \node (vrepeat) at (887bp,85bp) [draw,ellipse] {repeat};
  \node (sgoprev) at (250bp,320bp) [draw,ellipse] {an empty input from j};
  \node (slab) at (126bp,559bp) [draw,rectangle] {SINGULAR\_PARTITION\_i};
  \node (outs) at (544bp,85bp) [draw,rectangle] {SINGULAR\_PARTITION\_j};
  \node (srepeat) at (96bp,27bp) [draw,ellipse] {repeat};
  \node (outv) at (544bp,142bp) [draw,rectangle] {PARTITION\_j};
  \node (vbodylab) at (811bp,204bp) [draw,rectangle] {VECTOR\_BODY\_i};
  \coordinate (aux) at (47bp,435bp);
  \node (sterm00) at (248bp,377bp) [draw,ellipse] {$\begin{matrix} \text{/*is min or max} \\ \text{topologically*/} \end{matrix}$ };
  \node (sterm0) at (222bp,497bp) [draw,ellipse] {i == 0 ? handle\_termination\_zero};
  \node (vlab) at (702bp,497bp) [draw,rectangle] {PARTITION\_i};
  \coordinate (vaux) at (695bp,377bp);
  \node (vgonext) at (812bp,262bp) [draw,ellipse] {$\begin{matrix} \text{not enough space} \\ \text{in an output to j} \end{matrix}$ };
  \node (sgovector) at (292bp,204bp) [draw,ellipse] {process vectorized};
  \node (vgoprev) at (815bp,320bp) [draw,ellipse] {$\begin{matrix} \text{not enough data} \\ \text{in an input from j} \end{matrix}$ };
  \node (sgonext) at (152bp,142bp) [draw,ellipse] {afull output to j};
  \node (vterm0) at (818bp,435bp) [draw,ellipse] {i == 0 ? remaining < w};
  \node (sgovectorized) at (251bp,262bp) [draw,ellipse] {$\begin{matrix} \text{not enough input or space} \\ \text{for vectorized body} \end{matrix}$ };
  \node (vterm) at (826bp,377bp) [draw,ellipse] {i != 0 \&\& i is terminating};
  \draw [->,very thick] (sgovectorized) -- (sgovector);
  \draw [->,dotted] (vgonext) -- (outv);
  \draw [->,dotted] (sterm) -- (outv);
  \draw [->,very thick] (vterm) -- (vgoprev);
  \draw [->,very thick] (sgonext) -- (sbody);
  \draw [<-,dotted] (ins) -- (vgoprev);
  \draw [->,dotted] (sterm0) -- (outv);
  \draw [->,solid] (sterm00) -- (vlab);
  \draw [->,very thick] (vbody) -- (vrepeat);
  \draw [->,very thick] (vterm0) -- (vterm);
  \draw [->,solid] (sterm) -- (sbodylab);
  \draw [->,very thick] (sterm0) -- (sterm);
  \draw [->,very thick] (vbodylab) -- (vbody);
  \draw [->,very thick] (sbody) -- (srepeat);
  \draw [->,solid] (sgovector) -- (vbodylab);
  \draw [->] (sgovectorized) -- (sbodylab);
  \draw [<-,dotted] (ins) -- (sgoprev);
  \draw [] (aux) -- (srepeat);
  \draw [->,very thick] (sterm) -- (sterm00);
  \draw [->,dotted] (sgonext) -- (outs);
  \draw [->,very thick] (vgonext) -- (vbodylab);
  \draw [<-] (slab) -- (aux);
  \draw [->,very thick] (slab) -- (sterm0);
  \draw [->,solid] (vterm) -- (slab);
  \draw [] (vaux) -- (vrepeat);
  \draw [<-] (vlab) -- (vaux);
  \draw [->,very thick] (sgoprev) -- (sgovectorized);
  \draw [->,solid] (vterm0) -- (slab);
  \draw [->,very thick] (vlab) -- (vterm0);
  \draw [->,solid] (sterm0) -- (sbodylab);
  \draw [->,very thick] (vgoprev) -- (vgonext);
  \draw [->,very thick] (sterm00) -- (sgoprev);
  \draw [->,very thick] (sbodylab) -- (sgonext);
%
\end{tikzpicture}

